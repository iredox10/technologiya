---
import MainLayout from '../../layouts/MainLayout.astro';
import ArticleCard from '../../components/ArticleCard';
import { mockArticles, getArticleBySlug, getRelatedArticles } from '../../data/mockData';
import { formatHausaDate, getReadingTime } from '../../utils/hausa';
import { FiClock, FiEye, FiShare2, FiUser, FiCalendar } from 'react-icons/fi';
import { FaFacebook, FaTwitter, FaWhatsapp, FaLinkedin } from 'react-icons/fa';

export function getStaticPaths() {
  return mockArticles.map((article) => ({
    params: { slug: article.slug },
    props: { article },
  }));
}

const { article } = Astro.props;
const relatedArticles = getRelatedArticles(article.id);
const shareUrl = Astro.url.href;
const shareTitle = encodeURIComponent(article.title);
---

<MainLayout
  title={`${article.title} - Technologiya`}
  description={article.excerpt}
  image={article.coverImage}
>
  <article class="container mx-auto px-4 py-8 max-w-4xl">
    
    <!-- Article Header -->
    <header class="mb-8">
      <!-- Category Badge -->
      <div class="mb-4">
        <a 
          href={`/category/${article.category.slug}`}
          class="category-badge inline-block px-4 py-1.5 text-sm font-semibold text-white bg-blue-600 hover:bg-blue-700 rounded-full transition-colors tracking-wider uppercase"
        >
          {article.category.name}
        </a>
      </div>

      <!-- Title -->
      <h1 class="font-display text-4xl md:text-5xl font-bold text-gray-900 dark:text-gray-100 mb-6 leading-tight tracking-tight">
        {article.title}
      </h1>

      <!-- Meta Information -->
      <div class="flex flex-wrap items-center gap-6 text-gray-600 dark:text-gray-400 mb-6">
        <div class="flex items-center space-x-2">
          {article.author.avatar && (
            <img 
              src={article.author.avatar} 
              alt={article.author.name}
              class="w-10 h-10 rounded-full"
            />
          )}
          <div>
            <p class="font-mono text-sm font-medium text-gray-900 dark:text-gray-100">
              {article.author.name}
            </p>
            <p class="text-xs text-gray-500 dark:text-gray-500">
              Marubucin labari
            </p>
          </div>
        </div>

        <div class="meta-info flex items-center space-x-1 text-sm tabular-nums">
          <FiCalendar class="w-4 h-4" />
          <span>{formatHausaDate(article.publishedAt, 'full')}</span>
        </div>

        <div class="meta-info flex items-center space-x-1 text-sm tabular-nums">
          <FiClock class="w-4 h-4" />
          <span>{getReadingTime(article.content)}</span>
        </div>

        {article.views && (
          <div class="stat-number flex items-center space-x-1 text-sm tabular-nums">
            <FiEye class="w-4 h-4" />
            <span>{article.views.toLocaleString()} kallonin</span>
          </div>
        )}
      </div>

      <!-- Tags -->
      {article.tags.length > 0 && (
        <div class="flex flex-wrap gap-2 mb-6">
          {article.tags.map((tag) => (
            <span class="font-mono px-3 py-1 text-xs font-medium bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded-full tracking-wide">
              #{tag}
            </span>
          ))}
        </div>
      )}

      <!-- Featured Image -->
      <div class="relative rounded-xl overflow-hidden shadow-2xl mb-8">
        <img 
          src={article.coverImage} 
          alt={article.title}
          class="w-full h-auto"
        />
      </div>

      <!-- Share Buttons -->
      <div class="flex items-center space-x-3 mb-8 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg">
        <FiShare2 class="w-5 h-5 text-gray-600 dark:text-gray-400" />
        <span class="text-sm font-medium text-gray-700 dark:text-gray-300 mr-2">Raba:</span>
        
        <a
          href={`https://www.facebook.com/sharer/sharer.php?u=${shareUrl}`}
          target="_blank"
          rel="noopener noreferrer"
          class="p-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white transition-colors"
          aria-label="Raba a Facebook"
        >
          <FaFacebook class="w-4 h-4" />
        </a>

        <a
          href={`https://twitter.com/intent/tweet?text=${shareTitle}&url=${shareUrl}`}
          target="_blank"
          rel="noopener noreferrer"
          class="p-2 rounded-lg bg-sky-500 hover:bg-sky-600 text-white transition-colors"
          aria-label="Raba a Twitter"
        >
          <FaTwitter class="w-4 h-4" />
        </a>

        <a
          href={`https://wa.me/?text=${shareTitle}%20${shareUrl}`}
          target="_blank"
          rel="noopener noreferrer"
          class="p-2 rounded-lg bg-green-600 hover:bg-green-700 text-white transition-colors"
          aria-label="Raba a WhatsApp"
        >
          <FaWhatsapp class="w-4 h-4" />
        </a>

        <a
          href={`https://www.linkedin.com/sharing/share-offsite/?url=${shareUrl}`}
          target="_blank"
          rel="noopener noreferrer"
          class="p-2 rounded-lg bg-blue-700 hover:bg-blue-800 text-white transition-colors"
          aria-label="Raba a LinkedIn"
        >
          <FaLinkedin class="w-4 h-4" />
        </a>
      </div>
    </header>

    <!-- Article Content -->
    <div class="prose prose-lg dark:prose-invert max-w-none mb-12
                prose-headings:text-gray-900 dark:prose-headings:text-gray-100
                prose-p:text-gray-700 dark:prose-p:text-gray-300
                prose-a:text-blue-600 dark:prose-a:text-blue-400
                prose-strong:text-gray-900 dark:prose-strong:text-gray-100
                prose-code:text-gray-900 dark:prose-code:text-gray-100
                prose-pre:bg-gray-800 dark:prose-pre:bg-gray-900
                prose-img:rounded-lg prose-img:shadow-lg
                prose-ul:list-disc prose-ul:pl-6
                prose-ol:list-decimal prose-ol:pl-6
                prose-li:text-gray-700 dark:prose-li:text-gray-300">
      <div set:html={article.content} />
    </div>

    <!-- Author Bio -->
    {article.author.bio && (
      <div class="bg-gray-50 dark:bg-gray-800 rounded-xl p-6 mb-12">
        <h3 class="text-lg font-bold text-gray-900 dark:text-gray-100 mb-4 flex items-center">
          <FiUser class="w-5 h-5 mr-2" />
          Game da Marubucin
        </h3>
        <div class="flex items-start space-x-4">
          {article.author.avatar && (
            <img 
              src={article.author.avatar} 
              alt={article.author.name}
              class="w-16 h-16 rounded-full"
            />
          )}
          <div>
            <h4 class="font-bold text-gray-900 dark:text-gray-100 mb-1">
              {article.author.name}
            </h4>
            <p class="text-gray-600 dark:text-gray-400 text-sm">
              {article.author.bio}
            </p>
          </div>
        </div>
      </div>
    )}

    <!-- Related Articles -->
    {relatedArticles.length > 0 && (
      <section class="mt-16 pt-8 border-t border-gray-200 dark:border-gray-800">
        <h2 class="text-2xl font-bold text-gray-900 dark:text-gray-100 mb-6">
          Labarai Masu Ala∆ôa
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          {relatedArticles.map((related) => (
            <ArticleCard article={related} client:visible />
          ))}
        </div>
      </section>
    )}

  </article>
</MainLayout>
